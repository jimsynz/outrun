================
Complex field values in struct construction
================

def create_user_profile() {
    let user = User {
        id: UUID.generate(),
        name: String.capitalize(input: "john doe"),
        email: String.downcase(input: name) + "@example.com",
        age: Config.get(key: "default_age", default: 18) + 5,
        preferences: UserPreferences {
            theme: if dark_mode_enabled { :dark } else { :light },
            language: case user_locale {
                when "en" -> :english
                when "es" -> :spanish
                else -> :english
            },
            notifications: NotificationSettings {
                email: true,
                push: Config.feature_enabled?(feature: "push_notifications"),
                frequency: case priority_level {
                    when level > 5 -> :immediate
                    when level > 2 -> :daily
                    else -> :weekly
                }
            }
        },
        metadata: {
            created_at: DateTime.now(),
            created_by: Current.user().id,
            tags: ["new_user", "web_signup"] + additional_tags,
            score: Math.max(initial_score, minimum_score) * boost_factor,
            location: GeoLocation.from_ip(ip: request_ip) |> GeoLocation.to_coordinates()
        },
        avatar_url: Avatar.generate(
            seed: user_id,
            style: avatar_style,
            background: Color.random(saturation: 0.7, brightness: 0.9)
        )
    }
    user
}

---

(source_file
  (item
    (function_definition
      (identifier)
      (block
        (statement
          (let_binding
            (identifier)
            (expression
              (primary_expression
                (struct_literal
                  (module_path
                    (type_identifier))
                  (struct_literal_fields
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (primary_expression
                            (function_call
                              (module_path
                                (type_identifier))
                              (identifier))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (primary_expression
                            (function_call
                              (module_path
                                (type_identifier))
                              (identifier)
                              (argument_list
                                (argument
                                  (named_argument
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (literal
                                          (string
                                            (string_content)))))))))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (binary_add
                            (primary_expression
                              (function_call
                                (module_path
                                  (type_identifier))
                                (identifier)
                                (argument_list
                                  (argument
                                    (named_argument
                                      (identifier)
                                      (expression
                                        (primary_expression
                                          (identifier))))))))
                            (primary_expression
                              (literal
                                (string
                                  (string_content))))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (binary_add
                            (primary_expression
                              (function_call
                                (module_path
                                  (type_identifier))
                                (identifier)
                                (argument_list
                                  (argument
                                    (named_argument
                                      (identifier)
                                      (expression
                                        (primary_expression
                                          (literal
                                            (string
                                              (string_content)))))))
                                  (argument
                                    (named_argument
                                      (identifier)
                                      (expression
                                        (primary_expression
                                          (literal
                                            (integer)))))))))
                            (primary_expression
                              (literal
                                (integer)))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (primary_expression
                            (struct_literal
                              (module_path
                                (type_identifier))
                              (struct_literal_fields
                                (struct_literal_field
                                  (struct_field_assignment
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (if_expression
                                          (expression
                                            (primary_expression
                                              (identifier)))
                                          (block
                                            (statement
                                              (expression
                                                (primary_expression
                                                  (literal
                                                    (atom
                                                      (identifier)))))))
                                          (block
                                            (statement
                                              (expression
                                                (primary_expression
                                                  (literal
                                                    (atom
                                                      (identifier))))))))))))
                                (struct_literal_field
                                  (struct_field_assignment
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (case_expression
                                          (expression
                                            (primary_expression
                                              (identifier)))
                                          (case_clause
                                            (case_pattern
                                              (guard_expression
                                                (expression
                                                  (primary_expression
                                                    (literal
                                                      (string
                                                        (string_content)))))))
                                            (expression
                                              (primary_expression
                                                (literal
                                                  (atom
                                                    (identifier))))))
                                          (case_clause
                                            (case_pattern
                                              (guard_expression
                                                (expression
                                                  (primary_expression
                                                    (literal
                                                      (string
                                                        (string_content)))))))
                                            (expression
                                              (primary_expression
                                                (literal
                                                  (atom
                                                    (identifier))))))
                                          (else_clause
                                            (expression
                                              (primary_expression
                                                (literal
                                                  (atom
                                                    (identifier)))))))))))
                                (struct_literal_field
                                  (struct_field_assignment
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (struct_literal
                                          (module_path
                                            (type_identifier))
                                          (struct_literal_fields
                                            (struct_literal_field
                                              (struct_field_assignment
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (literal
                                                      (boolean))))))
                                            (struct_literal_field
                                              (struct_field_assignment
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (function_call
                                                      (module_path
                                                        (type_identifier))
                                                      (identifier)
                                                      (argument_list
                                                        (argument
                                                          (named_argument
                                                            (identifier)
                                                            (expression
                                                              (primary_expression
                                                                (literal
                                                                  (string
                                                                    (string_content)))))))))))))
                                            (struct_literal_field
                                              (struct_field_assignment
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (case_expression
                                                      (expression
                                                        (primary_expression
                                                          (identifier)))
                                                      (case_clause
                                                        (case_pattern
                                                          (guard_expression
                                                            (expression
                                                              (binary_greater
                                                                (primary_expression
                                                                  (identifier))
                                                                (primary_expression
                                                                  (literal
                                                                    (integer)))))))
                                                        (expression
                                                          (primary_expression
                                                            (literal
                                                              (atom
                                                                (identifier))))))
                                                      (case_clause
                                                        (case_pattern
                                                          (guard_expression
                                                            (expression
                                                              (binary_greater
                                                                (primary_expression
                                                                  (identifier))
                                                                (primary_expression
                                                                  (literal
                                                                    (integer)))))))
                                                        (expression
                                                          (primary_expression
                                                            (literal
                                                              (atom
                                                                (identifier))))))
                                                      (else_clause
                                                        (expression
                                                          (primary_expression
                                                            (literal
                                                              (atom
                                                                (identifier)))))))))))))))))))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (primary_expression
                            (map_literal
                              (map_entry
                                (map_shorthand_pair
                                  (identifier)
                                  (expression
                                    (primary_expression
                                      (function_call
                                        (module_path
                                          (type_identifier))
                                        (identifier))))))
                              (map_entry
                                (map_shorthand_pair
                                  (identifier)
                                  (expression
                                    (primary_expression
                                      (function_call
                                        (module_path
                                          (type_identifier))
                                        (identifier)))
                                    (field_access
                                      (identifier)))))
                              (map_entry
                                (map_shorthand_pair
                                  (identifier)
                                  (expression
                                    (binary_add
                                      (primary_expression
                                        (list_literal
                                          (expression
                                            (primary_expression
                                              (literal
                                                (string
                                                  (string_content)))))
                                          (expression
                                            (primary_expression
                                              (literal
                                                (string
                                                  (string_content)))))))
                                      (primary_expression
                                        (identifier))))))
                              (map_entry
                                (map_shorthand_pair
                                  (identifier)
                                  (expression
                                    (binary_multiply
                                      (primary_expression
                                        (function_call
                                          (module_path
                                            (type_identifier))
                                          (identifier)
                                          (argument_list
                                            (argument
                                              (shorthand_argument
                                                (identifier)))
                                            (argument
                                              (shorthand_argument
                                                (identifier))))))
                                      (primary_expression
                                        (identifier))))))
                              (map_entry
                                (map_shorthand_pair
                                  (identifier)
                                  (expression
                                    (pipe_expression
                                      (primary_expression
                                        (function_call
                                          (module_path
                                            (type_identifier))
                                          (identifier)
                                          (argument_list
                                            (argument
                                              (named_argument
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (identifier))))))))
                                      (primary_expression
                                        (function_call
                                          (module_path
                                            (type_identifier))
                                          (identifier))))))))))))
                    (struct_literal_field
                      (struct_field_assignment
                        (identifier)
                        (expression
                          (primary_expression
                            (function_call
                              (module_path
                                (type_identifier))
                              (identifier)
                              (argument_list
                                (argument
                                  (named_argument
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (identifier)))))
                                (argument
                                  (named_argument
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (identifier)))))
                                (argument
                                  (named_argument
                                    (identifier)
                                    (expression
                                      (primary_expression
                                        (function_call
                                          (module_path
                                            (type_identifier))
                                          (identifier)
                                          (argument_list
                                            (argument
                                              (named_argument
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (literal
                                                      (float))))))
                                            (argument
                                              (named_argument
                                                (identifier)
                                                (expression
                                                  (primary_expression
                                                    (literal
                                                      (float))))))))))))))))))))))))
        (statement
          (expression
            (primary_expression
              (identifier))))))))
